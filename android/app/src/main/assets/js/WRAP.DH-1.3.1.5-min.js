var WRAP;"undefined"==typeof WRAP&&(WRAP={}),WRAP.DH={version:"1.3",conf_path:"./pri/wrap/conf/data",setUser:function(e,t){if(this.option||(this.option={}),this.option.user=t,this.option.customer=e,this._data)for(var a in this._data)this._data[a].ref.load()},set:function(e){if(e){for(var t=["id","x","y","z","time","start_time","end_time","current_time"],a=0,i=0;i<t.length;i++)e[t[i]]&&(console.error("WRAP.DH.set() Error:reserved keyword used. ["+t[i]+"]"),a++);if(a)return}if(this.option=e,this._data)for(var r in this._data)this._data[r].ref.load()},addObject:function(e){var t=this;t._data[e]={name:e,base:{},load:[],inspect:[]};var a=this.conf_path+"/"+e+".json";return this._getJSON(a,"configuration",function(a){var i=t._data[e];i.conf=a;var r=a.DataHandler;r&&t.DataHandler[r]?(i.handler=new t.DataHandler[r](i.ref,i.conf,i.base),WRAP.DH._load(i)):t._error("Implementation WRAP.DH.DataHandler."+r+" not found.")}),t._data[e].ref=new this.Reference(e)},removeObject:function(e){delete this._data[e]},query:function(e){return new this.Reference(e)},Reference:function(e,t){if(t)this._string=t._string+"."+e,this._data=t._data;else{this._string=e;var a=e.split(".");a.length&&(this._data=WRAP.DH._data[a[0]])||WRAP.DH._error("Invalid reference. key="+e+" root object not found.")}this._path=(t?t._path:[]).concat(e?e.split("."):[]),this.query=function(e){return new WRAP.DH.Reference(e,this)},this.length=function(){var e=this.value();return Array.isArray(e)?e.length:0},this.value=function(){var e,t=this._data;if(t&&(t.handler&&t.handler.resolve&&t.handler.resolve(this),e=t.base))for(var a=1;a<this._path.length;a++){var i=this._path[a];if(!(e=this._resolve(e,i)))break}return e},this.available=function(){return!(void 0===this.value())},this.load=function(e){this._data.load.push({ref:this,cb:e?e:this._nop}),WRAP.DH._load(this._data)},this.inspect=function(e,t){if(e){var a=this._string+"."+e.toString();this._data.inspect.push({key:a,ref:this,cb:e}),t&&this.available()&&e(this)}else for(var i=0;i<this._data.inspect.length;i++){if(this._data.inspect[i].ref==this)return void this.splice(i,1);i++}},this.filter=function(e){var t=this.value();if(Array.isArray(t)){for(var a=[],i=t.length,r=0;r<i;r++){var n=e(t[r]);void 0!==n&&a.push(n)}return a}},this.validate=function(e){this.validator=e},this.setIndex=function(e){if(this._data.handler&&this._data.handler.setIndex){var t=this._data;t.handler.setIndex(e,this,function(e,a){if(a){for(var i=0;i<t.inspect.length;i++){var r=t.inspect[i];(a._contain(r.ref)||r.ref._contain(a))&&r.cb(r.ref)}a.cb&&(a.cb(e,a),delete a.cb)}})}},this.getData=function(e,t){if(t){if(this._data&&this._data.handler){var a=this._data.handler;if(a.getData&&a.loadData){var i=a.getData(e);return i?void t(i):void a.loadData(e,null,function(){var i=a.getData(e);i&&t(i)})}}t(null)}},this._resolve=function(e,t){var a,i=t.indexOf("["),r=t.indexOf("]");if(i<0&&r<0)a=e[t];else if(i<0||r<0)WRAP.DH._error('Invalid reference key. "'+t+'"');else{var n=t.substring(0,i);if(a=e[n]){var o=t.indexOf("=");if(o>i){if(Array.isArray(a)){for(var l=t.substring(i+1,o),s=t.substring(o+1,r),d=a.length,u=0;u<d&&a[u][l]!=s;)u++;a=u<d?a[u]:void 0}}else{var l=t.substring(i+1,r);a=a[l]}}}return a},this._contain=function(e){for(var t=this._path.length,a=0;a<t;a++)if(this._path[a]!=e._path[a])return!1;return!0},this._equal=function(e){var t=this._path.length;if(t!=e._path.length)return!1;for(var a=0;a<t;a++)if(this._path[a]!=e._path[a])return!1;return!0},this._handler=function(){return this._data.handler},this._nop=function(){}},DataHandler:{},_cache:function(e){this.array=[],this.max=e,this.get=function(e){for(var t=0;t<this.array.length;t++)if(this.array[t].key==e){var a=this.array[t];return this.array.splice(t,1),this.array.unshift(a),a}return null},this.set=function(e,t){var a=this.get(e);return a?void(a.data=t):(this.array.unshift({key:e,data:t}),void(this.array.length>=this.max&&this.array.pop()))}},_get:function(e,t,a,i){var r=this,n=new XMLHttpRequest;if(n){n.onreadystatechange=function(){4===n.readyState&&(200===n.status||0===n.status?a(n.responseText):(r._error(t+" load error. ("+n.status+") ["+e+"]"),i?i():a(null)))};var o=e.indexOf("?")>=0?"&":"?";o+="t="+(new Date).getTime(),n.open("GET",e+o,!0),n.send(null)}},_getJSON:function(e,t,a,i){var r=this;this._get(e,t,function(n){var o=null;try{o=JSON.parse(n)}catch(a){r._error(t+" parse error. ["+e+"]")}o?a(o,e):i?i(e):a(null)},i)},_load:function(e){if(e.handler)for(var t;t=e.load.shift();)t.ref.cb=t.cb,e.handler.load(t.ref,function(t,a){if(a){for(var i=0;i<e.inspect.length;i++){var r=e.inspect[i];(a._contain(r.ref)||r.ref._contain(a))&&r.cb(r.ref)}a.cb&&(a.cb(t,a),delete a.cb)}})},_getCurrentConfiguration:function(e){if(e){if(WRAP.DH.option)for(var t in WRAP.DH.option)e=this._customizeConfiguration(e,t,WRAP.DH.option[t]);return e=this._customizeConfiguration(e,"current_time",WRAP.Core.currentTime().text())}},_customizeConfiguration:function(e,t,a){var i="%"+t+"%";return e.indexOf(i)>=0&&(e=e.replace(i,a)),e},_padding:function(e,t){void 0==t&&(t=2);for(var a=""+e;a.length<t;)a="0"+a;return a},_timeString:function(e,t,a,i){var r="";return 1==arguments.length&&(t="",a="T",i=""),(""==t||t)&&(r+=e.getUTCFullYear()+t,r+=this._padding(e.getUTCMonth()+1)+t,r+=this._padding(e.getUTCDate())),a&&(r+=a),(""==i||i)&&(r+=this._padding(e.getUTCHours())+i,r+=this._padding(e.getUTCMinutes())+i,r+=this._padding(e.getUTCSeconds())),r},_time:function(e){e=e.replace(/ +/g," ").replace(/:| |T|\//g,",");for(var t=[0,0,0,0,0,0,-1],a=[4,2,2,2,2,2,-1],i=0,r=0,n=0;n<e.length&&a[i]>0;n++){var o=e.charAt(n);isNaN(o)?","==o&&(i++,r=0):(a[i]==r&&(i++,r=0),t[i]=10*t[i]+parseInt(o),r++)}return new Date(Date.UTC(t[0],t[1]-1,t[2],t[3],t[4],t[5]))},_currentTime:function(){return new Date},_setTime:function(e,t){return new Date(e.getTime()+1e3*t)},_elapsed:function(e,t){return parseInt((t.getTime()-e.getTime())/1e3)},_error:function(e){console.warn((this.name||"Error")+":"+e)},_data:{},Test:{}},WRAP.DH.DataHandler.GeoTiff=function(e,t,a){function i(e,t){this.dataView=new A(e),t=t||{},this.cache=t.cache||!1;var a=this.dataView.getUint16(0,0);if(18761===a)this.littleEndian=!0;else{if(19789!==a)throw new TypeError("Invalid byte order value.");this.littleEndian=!1}var i=this.dataView.getUint16(2,this.littleEndian);if(42===this.dataView.getUint16(2,this.littleEndian))this.bigTiff=!1;else{if(43!==i)throw new TypeError("Invalid magic number.");this.bigTiff=!0;var r=this.dataView.getUint16(4,this.littleEndian);if(8!==r)throw new Error("Unsupported offset byte-size.")}this.fileDirectories=this.parseFileDirectories(this.getOffset(this.bigTiff?8:4))}function r(e){if(l.alternative_file){var t=e.basetime,i=e.validtime;if(t&&i&&a.timelist){for(var r=0;r<a.timelist.length;r++)if(a.timelist[r].basetime==t){if(a.timelist[r].validtime.indexOf(i)>=0)return l.file;break}}else if(i&&a.validtime&&a.validtime.indexOf(i)>=0)return l.file;return l.alternative_file}return l.file}function n(e,t){var a=[],i=r(e);i=WRAP.DH._getCurrentConfiguration(i);var n=e.element&&Array.isArray(e.element)?e.element.length:0;if(n)for(var o=0;o<n;o++){var l=i;for(var s in e){var d=e[s];"element"==s&&(d=e[s][o]);var u="%"+s+"%";l.indexOf(u)>=0&&(l=l.replace(u,d))}if(t)for(var s in t){var u="%"+s+"%";l.indexOf(u)>=0&&(l=l.replace(u,t[s]))}a.push({file:l,index:o})}else{var l=i;for(var s in e){var u="%"+s+"%";l.indexOf(u)>=0&&(l=l.replace(u,e[s]))}if(t)for(var s in t){var u="%"+s+"%";l.indexOf(u)>=0&&(l=l.replace(u,t[s]))}a.push({file:l,index:0})}return a}function o(e,t,a){var i="",r=0;for(var n in e){var o=e[n];if(Array.isArray(o)&&o.length)for(var l=o[0],s=0;s<o.length;s++)l+="+"+o[s];r++&&(i+="/"),i+=o}return i+="/"+t,a&&(i+="/"+a),i}var l=this;if(l.name=t.Name,l.ref=e,l.tile_cache=new WRAP.DH._cache(1e3),l.data_cache=new WRAP.DH._cache(200),l.file=t.Attributes.File,l.alternative_file=t.Attributes.AlternativeFile,l.grid=t.Attributes.DataGrid,l.update_interval=parseFloat(t.Attributes.UpdateInterval),l.boundary={n:l.grid.LatBase,w:l.grid.LonBase,s:l.grid.LatBase-l.grid.LatInterval*l.grid.Height,e:l.grid.LonBase+l.grid.LonInterval*l.grid.Width},l.wrap_round=l.grid.LonInterval*l.grid.Width>=360,l.tiled=l.grid.TileSize,l.tiled){for(var s=0,d=0,u=l.tiled,f=l.tiled;u<l.grid.Height;)u*=2,s++;for(;f<l.grid.Width;)f*=2,d++;l.max_zoom=s>d?s:d}this.autoUpdate=function(){if(this.timer&&(clearTimeout(this.timer),this.timer=null),l.update_interval>0){var e=WRAP.Core.currentTimeScale();if(e>0){var t=1e3*l.update_interval/e;this.timer=setTimeout(function(){l.ref.load()},t)}}},this.load=function(e,i){var r=WRAP.DH._getCurrentConfiguration(t.Attributes.TimeList);r&&WRAP.DH._getJSON(r,"Timelist",function(t){a.timelist=null,a.validtime=null,t?t.timelist?(a.timelist=t.timelist,i("completed",e)):t.validtime?(a.validtime=t.validtime,i("completed",e)):(WRAP.DH._error(l.name+" Timelist format."),i("error",e)):(WRAP.DH._error(l.name+" Timelist could not load."),i("error",e)),l.autoUpdate()})};var h,c={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams"},g={};for(h in c)g[c[h]]=parseInt(h);var v=[g.BitsPerSample,g.ExtraSamples,g.SampleFormat,g.StripByteCounts,g.StripOffsets,g.StripRowCounts,g.TileByteCounts,g.TileOffsets],m={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",16:"LONG8",17:"SLONG8",18:"IFD8"},p={};for(h in m)p[m[h]]=parseInt(h);var _={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"},y=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),A=function(){function e(e){this._dataView=new DataView(e)}return y(e,[{key:"getUint64",value:function(e,t){var a=this.getUint32(e,t),i=this.getUint32(e+4,t);return t?a<<32|i:i<<32|a}},{key:"getInt64",value:function(e,t){var a,i;return t?(a=this.getInt32(e,t),i=this.getUint32(e+4,t),a<<32|i):(a=this.getUint32(e,t),i=this.getInt32(e+4,t),i<<32|a)}},{key:"getUint8",value:function(e,t){return this._dataView.getUint8(e,t)}},{key:"getInt8",value:function(e,t){return this._dataView.getInt8(e,t)}},{key:"getUint16",value:function(e,t){return this._dataView.getUint16(e,t)}},{key:"getInt16",value:function(e,t){return this._dataView.getInt16(e,t)}},{key:"getUint32",value:function(e,t){return this._dataView.getUint32(e,t)}},{key:"getInt32",value:function(e,t){return this._dataView.getInt32(e,t)}},{key:"getFloat32",value:function(e,t){return this._dataView.getFloat32(e,t)}},{key:"getFloat64",value:function(e,t){return this._dataView.getFloat64(e,t)}},{key:"buffer",get:function(){return this._dataView.buffer}}]),e}();i.prototype={getOffset:function(e){return this.bigTiff?this.dataView.getUint64(e,this.littleEndian):this.dataView.getUint32(e,this.littleEndian)},getFieldTypeLength:function(e){switch(e){case p.BYTE:case p.ASCII:case p.SBYTE:case p.UNDEFINED:return 1;case p.SHORT:case p.SSHORT:return 2;case p.LONG:case p.SLONG:case p.FLOAT:return 4;case p.RATIONAL:case p.SRATIONAL:case p.DOUBLE:case p.LONG8:case p.SLONG8:case p.IFD8:return 8;default:throw new RangeError("Invalid field type: "+e)}},getValues:function(e,t,a){var i,r=null,n=null,o=this.getFieldTypeLength(e);switch(e){case p.BYTE:case p.ASCII:case p.UNDEFINED:r=new Uint8Array(t),n=this.dataView.getUint8;break;case p.SBYTE:r=new Int8Array(t),n=this.dataView.getInt8;break;case p.SHORT:r=new Uint16Array(t),n=this.dataView.getUint16;break;case p.SSHORT:r=new Int16Array(t),n=this.dataView.getInt16;break;case p.LONG:r=new Uint32Array(t),n=this.dataView.getUint32;break;case p.SLONG:r=new Int32Array(t),n=this.dataView.getInt32;break;case p.LONG8:case p.IFD8:r=new Array(t),n=this.dataView.getUint64;break;case p.SLONG8:r=new Array(t),n=this.dataView.getInt64;break;case p.RATIONAL:r=new Uint32Array(2*t),n=this.dataView.getUint32;break;case p.SRATIONAL:r=new Int32Array(2*t),n=this.dataView.getInt32;break;case p.FLOAT:r=new Float32Array(t),n=this.dataView.getFloat32;break;case p.DOUBLE:r=new Float64Array(t),n=this.dataView.getFloat64;break;default:throw new RangeError("Invalid field type: "+e)}if(e!==p.RATIONAL&&e!==p.SRATIONAL)for(i=0;i<t;++i)r[i]=n.call(this.dataView,a+i*o,this.littleEndian);else for(i=0;i<t;i+=2)r[i]=n.call(this.dataView,a+i*o,this.littleEndian),r[i+1]=n.call(this.dataView,a+(i*o+4),this.littleEndian);return e===p.ASCII?String.fromCharCode.apply(null,r):r},getFieldValues:function(e,t,a,i){var r,n=this.getFieldTypeLength(t);if(n*a<=(this.bigTiff?8:4))r=this.getValues(t,a,i);else{var o=this.getOffset(i);r=this.getValues(t,a,o)}return 1===a&&v.indexOf(e)===-1&&t!==p.RATIONAL&&t!==p.SRATIONAL?r[0]:r},parseGeoKeyDirectory:function(e){var t=e.GeoKeyDirectory;if(!t)return null;for(var a={},i=4;i<4*t[3];i+=4){var r=_[t[i]],n=t[i+1]?c[t[i+1]]:null,o=t[i+2],l=t[i+3],s=null;if(n){if(s=e[n],"undefined"==typeof s||null===s)throw new Error("Could not get value of geoKey '"+r+"'.");"string"==typeof s?s=s.substring(l,l+o-1):s.subarray&&(s=s.subarray(l,l+o-1))}else s=l;a[r]=s}return a},parseFileDirectories:function(e){for(var t=e,a=[];0!==t;){for(var i=this.bigTiff?this.dataView.getUint64(t,this.littleEndian):this.dataView.getUint16(t,this.littleEndian),r={},n=e+(this.bigTiff?8:2),o=0;o<i;n+=this.bigTiff?20:12,++o){var l=this.dataView.getUint16(n,this.littleEndian),s=this.dataView.getUint16(n+2,this.littleEndian),d=this.bigTiff?this.dataView.getUint64(n+4,this.littleEndian):this.dataView.getUint32(n+4,this.littleEndian);r[c[l]]=this.getFieldValues(l,s,d,n+(this.bigTiff?12:8))}a.push([r,this.parseGeoKeyDirectory(r)]),t=this.getOffset(n)}return a}};var T=function(e,t,a,r){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="arraybuffer",n.onload=function(){var o=3;if(!Module)return console.error("WRAP.ASM Module not found."),void r(e,[]);Module.printErr=function(e){e=null},Module.tmpFileID?Module.tmpFileID+=1:Module.tmpFileID=1;var l=String(Module.tmpFileID)+".tiff";Module.FS.createDataFile("/",l,new Uint8Array(n.response),!0,!1);var s=Module.ccall("TIFFOpen","number",["string","string"],[l,"r"]);if(!s)return console.error("Tiff load error. "+l),void r(e,[]);var d,u=new i(this.response),f=u.fileDirectories&&u.fileDirectories[0]&&u.fileDirectories[0][0],h=f.ImageWidth,c=f.ImageLength,g=f.SampleFormat&&f.SampleFormat[0],v=Module.ccall("_TIFFmalloc","number",["number"],[h*c*4]);if(d=g==o?Module.ccall("TIFFReadEncodedStrip","number",["number","number","number","number"],[s,0,v,h*c*4]):Module.ccall("TIFFReadRGBAImageOriented","number",["number","number","number","number","number","number"],[s,h,c,v,1,0]),0===d)return console.error("GeoTiff Data Parse Error"),void r([]);var f;f=g==o?Module.HEAPF32.subarray(v/4,v+h*c):Module.HEAPU8.subarray(v,v+h*c*4);var m=[],p=h*c;if(g==o)if(isNaN(t)||isNaN(a))if(isNaN(t))if(isNaN(a))for(var _=0;_<p;_++)m[_]=f[_];else for(var _=0;_<p;_++){var y=f[_];y<=a&&(m[_]=y)}else for(var _=0;_<p;_++){var y=f[_];t<=y&&(m[_]=y)}else for(var _=0;_<p;_++){var y=f[_];t<=y&&y<=a&&(m[_]=y)}Module.ccall("_TIFFfree","number",["number"],[v]),Module.ccall("TIFFClose","number",["number"],[s]),r(e,m)},n.onerror=function(){var t=[];r(e,t)},n.send()};this.getGrid=function(){return l.grid},this.getTile=function(e,t,a){var i=this.tile_cache.get(o(e,t,a));return i&&i.data?i.data:null},this.loadTile=function(e,t,a,i,r,s,d,u,f){function h(){for(var e=!0,t=0;t<g.length;t++)if(!g[t].data||!g[t].data.data){var r=l.data_cache.get(g[t].file);if(r&&r.data&&r.data.data){g[t].data=r.data;continue}e=!1;break}if(e){if(a.indexOf("value")>=0){var n=40,o=a.split(" ");o.length>1&&parseInt(o[1])&&(n=parseInt(o[1]));for(var s=u.north/60+.1,h=u.south/60,v=u.west/60-.1,m=u.east/60,p={data:[]},t=0;t<g.length;t++){for(var _=g[t],y=_.data.data,A=Math.pow(2,i),T=256/(360/A),D=1,b=_.lonInterval;D<256&&!(b*T>=n);)b*=2,D*=2;var w;for(w=_.latInterval>0?Math.round((_.n-90)/_.latInterval):Math.round((_.n+90)/_.latInterval);w>0;)w-=D;for(;w<0;)w+=D;for(var P=Math.round(-_.w/_.lonInterval);P>0;)P-=D;for(;P<0;)P+=D;for(K=w;K<_.active_height;K+=D){var I=_.n-_.latInterval*K;if(!(I>s||h>=I))for(j=P;j<_.active_width;j+=D){var S=_.w+_.lonInterval*j;if(S<-180?S+=360:S>=180&&(S-=360),!(S<v||m<=S)){var G=K*_.width+j,C=y[G];if(_.element>1){for(var O=null,R=0;R<p.data.length;R++){var x=p.data[R];if(x.lat==I&&x.lon==S){O=x,x.value[_.index]=C;break}}O||(O={lat:I,lon:S,value:[],x:j,y:K,step:D},O.value[_.index]=C,p.data.push(O))}else p.data.push({lat:I,lon:S,value:C,x:j,y:K,step:D})}}}}return l.tile_cache.set(c,p),void f()}if(a.indexOf("highest")>=0){var n=40,o=a.split(" ");o.length>1&&parseInt(o[1])&&(n=parseInt(o[1]));for(var s=u.north/60+.1,h=u.south/60,v=u.west/60-.1,m=u.east/60,p={data:[]},t=0;t<g.length;t++){for(var _=g[t],y=_.data.data,A=Math.pow(2,i),T=256/(360/A),D=1,b=_.lonInterval;D<256&&!(b*T>=n);){var F=2*D;b*=2,D=F}for(K=0;K<_.height;K+=D){var I=_.n-_.latInterval*(K+D/2);if(!(I>s||h>=I))for(j=0;j<_.width;j+=D){var S=_.w+_.lonInterval*(j+D/2);if(S<-180?S+=360:S>=180&&(S-=360),!(S<v||m<=S)){for(var C=void 0,L=0;L<D;L++)for(var M=0;M<D;M++){var G=(K+L)*_.width+(j+M),U=y[G];(void 0===C||C<U)&&(C=U)}if(_.element>1){for(var O=null,R=0;R<p.data.length;R++){var x=p.data[R];if(x.lat==I&&x.lon==S){O=x,x.value[_.index]=C;break}}O||(O={lat:I,lon:S,value:[],x:j,y:K,step:D},O.value[_.index]=C,p.data.push(O))}else p.data.push({lat:I,lon:S,value:C,x:j,y:K,step:D})}}}}return l.tile_cache.set(c,p),void f()}var N=65536,p={width:256,height:256};if(g.length&&g[0].element>1){p.data=[];for(var t=0;t<g[0].element;t++)p.data[t]=new Array(N)}else p.data=new Array(N);var E=0;if("interpolate"==a)for(var H=0;H<N;H++)for(var I=d[E++],S=d[E++],t=0;t<g.length;t++){var _=g[t],V=_.element<=1?p.data:p.data[_.index],y=_.data.data,W=(_.n-I)/_.latInterval,K=Math.floor(W);if(0<=K&&K<_.height){var k=(S>=_.w?S-_.w:S-(_.w-360))/_.lonInterval,j=Math.floor(k);if(0<=j&&j<_.width){var G=K*_.width+j,C=y[G],B=1;if(j==_.width-1&&(B=l.wrap_round?1-_.width:0),K+1<_.height){var z=C,Y=y[G+B],J=y[G+_.width],X=y[G+_.width+B],q=W-K,Z=k-j;C=z*(1-q)*(1-Z)+Y*(1-q)*Z+J*q*(1-Z)+X*Z*q}V[H]=C}}}else for(var H=0;H<N;H++)for(var I=d[E++],S=d[E++],t=0;t<g.length;t++){var _=g[t],V=_.element<=1?p.data:p.data[_.index],y=_.data.data,K=Math.round((_.n-I)/_.latInterval);if(0<=K&&K<_.height){var k=(S>=_.w?S-_.w:S-(_.w-360))/_.lonInterval,j=Math.round(k);if(l.wrap_round&&(j%=_.width),0<=j&&j<_.width){var G=K*_.width+j,C=y[G];V[H]=C}}}l.tile_cache.set(c,p),f()}return e}var c=o(e,t,a);if(l.tile_cache.get(c))return void f();var g=[];if(l.tiled){for(var v=d[0],m=d[1],p=d[131070],_=d[131071],y=Math.abs(_-m)/256,A=Math.abs(v-p)/256,D=0,b=l.grid.LonInterval,w=l.grid.LatInterval;D<l.max_zoom&&!(b>=y&&w>=A);)b*=2,w*=2,D++;for(var P=Math.pow(2,D),I=l.grid.TileSize*P,S=l.grid.LatInterval*I,G=l.grid.LonInterval*I,C=Math.ceil(l.grid.Height/I),O=Math.ceil(l.grid.Width/I),r=0;r<C;r++){var R=l.grid.LatBase-r*S,x=R-S;if(!(p>R||x>v))for(var s=0;s<O;s++){var F=l.grid.LonBase+s*G,L=F+G;if(F<-180?F+=360:F>=180&&(F-=360),L<-180?L+=360:L>=180&&(L-=360),L<F&&(L+=360),m<=L&&F<_||m+360<=L&&F<_+360)for(var M=n(e,{z:D,y:r,x:s}),U=0;U<M.length;U++){var N=l.data_cache.get(M[U].file),E=l.grid.TileSize,H=l.grid.TileSize;(s+1)*I>l.grid.Width&&(E=Math.floor((l.grid.Width-s*I)/P)),(r+1)*I>l.grid.Height&&(H=Math.floor((l.grid.Height-r*I)/P)),g.push({file:M[U].file,index:M[U].index,element:M.length,width:l.grid.TileSize,height:l.grid.TileSize,active_width:E,active_height:H,n:R,w:F,s:x,e:L,latInterval:l.grid.LatInterval*P,lonInterval:l.grid.LonInterval*P,data:N?N.data:null})}}}}else for(var M=n(e),U=0;U<M.length;U++){var N=l.data_cache.get(M[U]),V=e.element;M.length>1&&(V=e.element[M[U].index]);var W=l.grid.MinValue,K=l.grid.MaxValue,k=l.grid.element&&l.grid.element[V];k&&(k.MinValue&&(W=k.MinValue),k.MaxValue&&(K=k.MaxValue)),g.push({file:M[U].file,index:M[U].index,element:M.length,width:l.grid.Width,height:l.grid.Height,active_width:l.grid.Width,active_height:l.grid.Height,n:l.grid.LatBase,w:l.grid.LonBase,s:l.grid.LatBase-l.grid.LatInterval*l.grid.Height,e:l.grid.LonBase+l.grid.LonInterval*l.grid.Width,latInterval:l.grid.LatInterval,lonInterval:l.grid.LonInterval,minValue:W,maxValue:K,data:N?N.data:null})}if(!h())for(var U=0;U<g.length;U++)g[U].data||(g[U].data={},l.data_cache.set(g[U].file,g[U].data),T(g[U].file,g[U].minValue,g[U].maxValue,function(e,t){var a={data:t};l.data_cache.set(e,a);for(var i=0;i<g.length;i++)if(g[i].file==e){g[i].data=a,h();break}}))},this.loadGPV=function(e,t,a,i){t=0,a=0;var r=n(e);r&&r.length&&(r=r[0].file);var o=l.data_cache.get(r);if(o)o.data&&o.data.data?i(e,o.data.data):(o.wait||(o.wait=[]),o.wait.push(i));else{var s=e.element,d=l.grid.MinValue,u=l.grid.MaxValue,f=l.grid.element&&l.grid.element[s];f&&(f.MinValue&&(d=f.MinValue),f.MaxValue&&(u=f.MaxValue)),l.data_cache.set(r,{}),T(r,d,u,function(t,a){var r=l.data_cache.get(t);if(r&&r.wait)for(var n=0;n<r.wait.length;n++)r.wait[n](e,a);var o={data:a};l.data_cache.set(t,o),i(e,a)})}},this.getConf=function(){return t.Attributes},l.update_interval>0&&l.ref.load()},WRAP.DH.DataHandler.TMS=function(e,t,a){function i(e,t){var a=WRAP.DH._getCurrentConfiguration(n.file);for(var i in e){var r=e[i];if(r){"satdb"==n.api&&"validtime"==i&&(12==n.satdb_timestamp_length?r=r.substr(0,8)+r.substr(9,4):14==n.satdb_timestamp_length&&(r=r.substr(0,8)+r.substr(9,6)));var o="%"+i+"%";a.indexOf(o)>=0&&(a=a.replace(o,r))}}if(t)for(var i in t){var o="%"+i+"%";a.indexOf(o)>=0&&(a=a.replace(o,t[i]))}return a}function r(e,t,a){var i="",r=0;for(var n in e){var o=e[n];if(Array.isArray(o)&&o.length)for(var l=o[0],s=0;s<o.length;s++)l+="+"+o[s];r++&&(i+="/"),i+=o}return i+="/"+t,a&&(i+="/"+a),i}var n=this;n.name=t.Name,n.ref=e,n.tile_cache=new WRAP.DH._cache(1e3),n.api=t.Attributes.API,n.file=t.Attributes.File,n.grid=t.Attributes.DataGrid,n.bbox=n.grid.BoundingBox,n.ycoordinate=n.grid.YCoordinate||1,n.projection=n.grid.Projection||"Mercator",n.min_z=n.grid.MinZoom,n.max_z=n.grid.MaxZoom,n.update_interval=parseFloat(t.Attributes.UpdateInterval),this.autoUpdate=function(){if(this.timer&&(clearTimeout(this.timer),this.timer=null),n.update_interval>0){var e=WRAP.Core.currentTimeScale();if(e>0){var t=1e3*n.update_interval/e;this.timer=setTimeout(function(){n.ref.load()},t)}}},this.load=function(e,i){var r=WRAP.DH._getCurrentConfiguration(t.Attributes.TimeList);r&&WRAP.DH._getJSON(r,"Timelist",function(t){if(t.timelist)a.timelist=t.timelist,i("completed",e);else if(t.validtime)a.validtime=t.validtime,i("completed",e);else if("satdb"==n.api){a.validtime=[];for(var r=0;r<t.length;r++){var o=t[r].split("_");if(o.length>0){var l=o[o.length-1];n.satdb_timestamp_length=l.length,l=l.substr(0,8)+"T"+l.substr(8,6),13==l.length&&(l+="00"),a.validtime.push(l)}}a.validtime.sort(function(e,t){return e>t?-1:e<t?1:0}),i("completed",e)}else WRAP.DH._error(n.name+" Timelist format."),i("error",e);n.autoUpdate()})},this.getTile=function(e,t,a){var i=this.tile_cache.get(r(e,t,a));return i&&i.data?i.data:null},this.loadTile=function(e,t,a,o,l,s,d,u,f){var h=r(e,t,a);if(n.tile_cache.get(h))return void f();if(u&&n.bbox){var c=u.north/60,g=u.south/60,v=u.west/60,m=u.east/60;if(n.bbox.North<g||n.bbox.South>c||(n.bbox.East<v||n.bbox.West>m)&&(n.bbox.East+360<v||n.bbox.West+360>m)){var p={empty:!0,data:new Uint8Array(262144)};return n.tile_cache.set(h,p),void f()}}if(0==t.indexOf("E"))return this.loadETile(e,t,a,o,l,s,d,u,f);if("EQR"!=n.projection&&0==t.indexOf("W"))return this.loadETile(e,t,a,o,l,s,d,u,f);var _=s,y=l,A=o;if(o>n.max_z){var T=Math.pow(2,o-n.max_z);A=n.max_z,y=Math.floor(l/T),_=Math.floor(s/T);var D="M/"+A+"/"+y+"/"+_;0==t.indexOf("S")&&(D="S/"+A+"/"+y+"/"+_);var b=r(e,D,a),p=n.tile_cache.get(b);if(p&&p.data){if(p.data.canvas){var w=Math.floor(256/T),P=document.createElement("canvas");P.width=256,P.height=256;var I=P.getContext("2d"),S=I.getImageData(0,0,256,256),G=s-_*T,C=T-1-(l-y*T),O=p.data.data,R=S.data,x=C*w,F=G*w;if(T<256)for(var l=0;l<w;l++)for(var L=l*T,s=0;s<w;s++)for(var M=s*T,U=4*(256*(x+l)+(F+s)),N=O[U],E=O[U+1],H=O[U+2],V=O[U+3],W=0;W<T;W++)for(var K=4*(256*(L+W)+M),k=0;k<T;k++)R[K++]=N,R[K++]=E,R[K++]=H,R[K++]=V;else for(var K=0,U=4*(256*x+F),N=O[U],E=O[U+1],H=O[U+2],V=O[U+3],l=0;l<256;l++)for(var s=0;s<256;s++)R[K++]=N,R[K++]=E,R[K++]=H,R[K++]=V;var p={width:256,height:256,canvas:P,ctx:I,data:S.data};n.tile_cache.set(h,p),f()}else{var p={empty:!0,data:new Uint8Array(262144)};n.tile_cache.set(h,p),f()}return}h=b}n.ycoordinate==-1&&(y=Math.pow(2,A)-1-y);var j=i(e,{z:A,y:y,x:_});if(!j||j.indexOf("%")>=0){var p={empty:!0,data:new Uint8Array(262144)};return n.tile_cache.set(h,p),void f()}var B=new Image;B.crossOrigin="use-credentials",B.onload=function(){var e=document.createElement("canvas");e.width=256,e.height=256;var t=e.getContext("2d");t.drawImage(B,0,0);var a=t.getImageData(0,0,256,256),i={width:256,height:256,canvas:e,ctx:t,data:a.data,image:B};n.tile_cache.set(h,i),f()},B.onerror=function(){var e={empty:!0,data:new Uint8Array(262144)};n.tile_cache.set(h,e),f()},B.src=j},this.loadETile=function(e,t,a,i,o,l,s,d,u){function f(e,t){var a=20037508.34*e/180,i=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180);return i=20037508.34*i/180,[a,i]}function h(e,t){var a=e/20037508.34*180,i=t/20037508.34*180;return i=180/Math.PI*(2*Math.atan(Math.exp(i*Math.PI/180))-Math.PI/2),[a,i]}function c(e){return 40075016.68/(256*Math.pow(2,e))}function g(t){var r,o,s,d="M/"+i+"/"+t+"/"+l,f=0,c=0,g=0,m=0,T=t,D=l;r=256*D*_,o=256*(T-p/2)*_,s=h(r,o),g=s[0]-180,c=s[1],r=256*(D+1)*_,o=256*(T+1-p/2)*_,s=h(r,o),m=s[0]-180,f=s[1];var b=new WRAP.Geo.Bounds(60*f,60*c,60*m,60*g);n.loadTile(e,d,a,i,t,l,null,b,function(){for(var r={},o=!0,s=0;s<y.length;s++){var f="M/"+i+"/"+y[s]+"/"+l,h=n.getTile(e,f,a);if(!h){o=!1;break}r[y[s]]=h}if(!o){n.loadTile(e,d,a,i,t,l,null,null,function(){});for(var s=0;s<y.length;s++){var f="M/"+i+"/"+y[s]+"/"+l,h=n.getTile(e,f,a);if(!h)return;r[y[s]]=h}}var c=document.createElement("canvas");c.width=256,c.height=256;for(var g=c.getContext("2d"),m=g.getImageData(0,0,256,256),p=m.data,_=0,T=0;T<256;T++)for(var D=r[A[T].y].data,b=256*(255-A[T].p)*4,w=0;w<256;w++)p[_++]=D[b++],p[_++]=D[b++],p[_++]=D[b++],p[_++]=D[b++];var h={width:256,height:256,canvas:c,ctx:g,data:m.data};n.tile_cache.set(v,h),u()})}WRAP.Geo.check(d);for(var v=r(e,t,a),m=i,p=Math.pow(2,m),_=c(m),y=[],A=new Array(256),T={},o=0;o<256;o++){var D=s[256*o*2];D>85&&(D=85),D<-85&&(D=-85);var b=f(0,D),w=Math.floor(b[1]/_),P=Math.floor(w/256),I=w-256*P,S=P+p/2;T[S]=!0,A[o]={y:S,p:I}}for(var S in T)y.push(S);for(var G=0;G<y.length;G++)g(y[G],u)},n.update_interval>0&&n.ref.load()},WRAP.DH.DataHandler.DataJSON=function(e,t,a){var i=this;i.name=t.Name,i.ref=e,i.conf=t,i.update_interval=parseFloat(t.Attributes.UpdateInterval),i.position=null,a.data={},this.autoUpdate=function(){if(this.timer&&(clearTimeout(this.timer),this.timer=null),i.update_interval>0){var e=WRAP.Core.currentTimeScale();if(e>0){var t=1e3*i.update_interval/e;this.timer=setTimeout(function(){i.ref.load()},t)}}},this.load=function(e,r){var n=WRAP.DH._getCurrentConfiguration(t.Attributes.PointFile),o=WRAP.DH._getCurrentConfiguration(t.Attributes.DataFile);i._error=null,WRAP.DH._getJSON(n,t.Name,function(t){a.data.position=t,a.data.data&&r("completed",e)},function(e){i._error="Datahandler File Load Error("+e+")"}),WRAP.DH._getJSON(o,t.Name,function(t){a.data.data=t,a.data.position&&r("completed",e),i.autoUpdate()},function(e){i._error="Datahandler File Load Error("+e+")"})},i.update_interval>0&&i.ref.load()},WRAP.DH.DataHandler.GeoJSON=function(e,t,a){function i(e,t){var a=r.file;if(WRAP.DH.user&&a.indexOf("%user%")>=0&&(a=a.replace(/%user%/g,WRAP.DH.user)),WRAP.DH.customer&&a.indexOf("%customer%")>=0&&(a=a.replace(/%customer%/g,WRAP.DH.customer)),WRAP.DH.option)for(var i in WRAP.DH.option){var n="%"+i+"%";a.indexOf(n)>=0&&(a=a.replace(n,WRAP.DH.option[i]))}for(var i in e){var n="%"+i+"%";a.indexOf(n)>=0&&(a=a.replace(n,e[i]))}if(t)for(var i in t){var n="%"+i+"%";a.indexOf(n)>=0&&(a=a.replace(n,t[i]))}return a}var r=this;if(r.data_cache=new WRAP.DH._cache(500),r.name=t.Name,r.file=t.Attributes.File,r.timelist=t.Attributes.TimeList,r.grid=t.Attributes.DataGrid){r.min_zoom=r.grid.MinZoom,r.max_zoom=r.grid.MaxZoom;var n=r.grid.BoundingBox;if(n){r.sx=n.West,r.sy=n.North,r.ex=n.East,r.ey=n.South;var o=r.ex-r.sx,l=r.sy-r.ey;r.size=o>=l?o:l}}r.ref=e,r.update_interval=parseFloat(t.Attributes.UpdateInterval),this.autoUpdate=function(){if(this.timer&&(clearTimeout(this.timer),this.timer=null),r.update_interval>0){var e=WRAP.Core.currentTimeScale();if(e>0){var t=1e3*r.update_interval/e;this.timer=setTimeout(function(){r.ref.load()},t)}}},this.load=function(e,i){if(r.timelist){var n=WRAP.DH._getCurrentConfiguration(r.timelist);
WRAP.DH._getJSON(n,"Timelist",function(t){t.timelist?(a.timelist=t.timelist,i("completed",e)):t.validtime?(a.validtime=t.validtime,i("completed",e)):(WRAP.DH._error(r.name+" Timelist format."),i("error",null)),r.autoUpdate()})}else if(r.file){if(r.tiled())return;var n=WRAP.DH._getCurrentConfiguration(r.file);if(!n||n.indexOf("%")>=0)return;r._error=null,WRAP.DH._getJSON(n,t.Name,function(t){a.data=t,r.data_cache.set(n,t),i&&i("completed",e),r.autoUpdate()},function(e){r._error="Datahandler File Load Error("+e+")"})}},this.tiled=function(){return r.max_zoom},this.getTileList=function(e,t){var a=[];if(r.size>0){var n=Math.floor((r.min_zoom+r.max_zoom)/2);if(t.tiles.length){var o=t.zoom,l=360/Math.pow(2,o);n=0;for(var s=r.size;s>l;)s/=2,n++;--n<0&&(n=0)}n<r.min_zoom?n=r.min_zoom:n>r.max_zoom&&(n=r.max_zoom);var d=Math.pow(2,n),u=r.size/d,f=Math.floor((r.ex-r.sx)/u);f*u==r.ex-r.sx&&f--;var h=Math.floor((r.sy-r.ey)/u);h*u==r.sy-r.ey&&h--;for(var c=0;c<t.tiles.length;c++){for(var g=t.tiles[c],v=g.cood,m=v[0],p=v[1],_=v[131070],y=v[131071],A=Math.floor((r.sy-m)/u),T=Math.floor((r.sy-_)/u),D=Math.floor((p-r.sx)/u),b=Math.floor((y-r.sx)/u),w=A;w<=T;w++)if(0<=w&&w<=h)for(var P=D;P<=b;P++)if(0<=P&&P<=f){var I=i(e,{z:n,y:w,x:P});a.indexOf(I)<0&&a.push(I)}if(p>=180||y>=180){D=Math.floor((p-360-r.sx)/u),b=Math.floor((y-360-r.sx)/u);for(var w=A;w<=T;w++)if(0<=w&&w<=h)for(var P=D;P<=b;P++)if(0<=P&&P<=f){var I=i(e,{z:n,y:w,x:P});a.indexOf(I)<0&&a.push(I)}}}}return a},this.getTiles=function(e){for(var t=[],a=0;a<e.length;a++){var i=this.data_cache.get(e[a]);if(!i||!i.data)return null;t.push(i.data)}return t},this.getData=function(e,t){if(this.tiled()){var a=this.getTileList(e,t);return this.getTiles(a)}t=null;var r=i(e),n=this.data_cache.get(r);return n&&n.data?[n.data]:null},this.loadData=function(e,n,o){if(this.tiled())for(var l=this.getTileList(e,n),s=0;s<l.length;s++){var d=l[s],u=this.data_cache.get(d);u||WRAP.DH._getJSON(d,t.Name,function(e,t){r.data_cache.set(t,e),o&&r.getTiles(l)&&o()},function(e){r.data_cache.set(e,{}),o&&r.getTiles(l)&&o()})}else{var d=i(e);if(!d||d.indexOf("%")>=0)return;var u=this.data_cache.get(d);if(u&&u.data)return[u.data];WRAP.DH._getJSON(d,t.Name,function(e){a.data=e,r.data_cache.set(d,e),o&&o()})}},r.update_interval>0&&r.ref.load()},WRAP.DH.DataHandler.IndexedGeoJSON=function(e,t,a){function i(e,t){var i=a.index.index;for(var r in i)if(!i[r].loaded)return;t("completed",e)}function r(e,t,r){if(e){var o=a.index.index,l=n.datafile.replace("%id%",e);l=WRAP.DH._getCurrentConfiguration(l),WRAP.DH._getJSON(l,"Indexed GeoJSON",function(n){a.data[e]=n,o[e].loaded=!0,i(t,r)},function(a){o[e].loaded=!0,n._error="Datahandler File Load Error("+a+")",i(t,r)})}}var n=this;n.name=t.Name,n.indexfile=t.Attributes.Index,n.datafile=t.Attributes.File,n.ref=e,n.update_interval=parseFloat(t.Attributes.UpdateInterval),this.autoUpdate=function(){if(this.timer&&(clearTimeout(this.timer),this.timer=null),n.update_interval>0){var e=WRAP.Core.currentTimeScale();if(e>0){var t=1e3*n.update_interval/e;this.timer=setTimeout(function(){n.ref.load()},t)}}},this.load=function(e,t){var a=WRAP.DH._getCurrentConfiguration(n.indexfile);a&&(n._error=null,WRAP.DH._getJSON(a,"Index",function(a){n.setIndex(a,e,t),n.autoUpdate()},function(e){n._error="Datahandler File Load Error("+e+")"}))},this.setIndex=function(e,t,i){if(e.index){a.index=e,a.data={};var o=e.index;if(o)for(var l in o)r(l,t,i)}else WRAP.DH._error(n.name+" Index format."),i("error",t)},n.update_interval>0&&n.ref.load()},WRAP.DH.DataHandler.ACOS=function(e,t,a){function i(e,t){this.dataView=new p(e),t=t||{},this.cache=t.cache||!1;var a=this.dataView.getUint16(0,0);if(18761===a)this.littleEndian=!0;else{if(19789!==a)throw new TypeError("Invalid byte order value.");this.littleEndian=!1}var i=this.dataView.getUint16(2,this.littleEndian);if(42===this.dataView.getUint16(2,this.littleEndian))this.bigTiff=!1;else{if(43!==i)throw new TypeError("Invalid magic number.");this.bigTiff=!0;var r=this.dataView.getUint16(4,this.littleEndian);if(8!==r)throw new Error("Unsupported offset byte-size.")}this.fileDirectories=this.parseFileDirectories(this.getOffset(this.bigTiff?8:4))}function r(e,t){if(!e)return[];for(var a=e.DataGrid,i=a.LonBase,r=a.LatBase,n=a.LonInterval,o=a.LatInterval,l=-1,s=1,d=!1,u=[],f=a.Width,h=a.Height,c=l,g=f+2,v=h+2,m=g*v,p=new Array(m),_=0,y=0;y<v;y++)for(var A=0;A<g;A++){var T,D,b,w=-1,P=-1,I=-1,S=0,G=0,C=(y-1)*f+(A-1);y==v-1?T=D=b=c:0==y||0==A?(T=c,d?(D=0<y&&y<v-1&&t[C+1]!=c?-t[C+1]:c,b=y<v-2&&0<A&&A<g-1&&t[C+f]!=c?-t[C+f]:c):(D=0<y&&y<v-1?t[C+1]:c,b=y<v-2&&0<A&&A<g-1?t[C+f]:c)):d?(T=0<A&&A<g-1&&t[C]!=c?-t[C]:c,D=A<g-2&&t[C+1]!=c?-t[C+1]:c,b=y<v-2&&0<A&&A<g-1&&t[C+f]!=c?-t[C+f]:c):(T=0<A&&A<g-1?t[C]:c,D=A<g-2?t[C+1]:c,b=y<v-2&&0<A&&A<g-1?t[C+f]:c),T!=c?T>=s?(w=1,D==c?(P=0,S=1):D<s&&(P=(T-s)/(T-D)),b==c?(I=0,G=1):b<s&&(I=(T-s)/(T-b))):(w=0,D!=c&&D>=s&&(P=(T-s)/(T-D)),b!=c&&b>=s&&(I=(T-s)/(T-b))):(D!=c&&D>=s&&(P=1,S=1),b!=c&&b>=s&&(I=1,G=1)),p[_++]=[w,P,I,S,G]}for(var O=function(e,t){var a=p[t],l=Math.floor(t/g),s=t-l*g;l--,s--;var d,h=a[1],c=a[3];d=s<0?i:s==f-1?i+n*s:i+n*s+h*n;var v=r-o*l;e.push({lat:v,lon:d,clip:c}),a[1]=-1;var m;if(1==a[0]){if(p[m=t+1][2]>=0)return R(e,m);if(p[m=t+g][1]>=0)return O(e,m);if(p[m=t][2]>=0)return R(e,m)}else{if(p[m=t-g][2]>=0)return R(e,m);if(p[m=t-g][1]>=0)return O(e,m);if(p[m=t-g+1][2]>=0)return R(e,m)}var _=e[0];_&&(e.push({lat:_.lat,lon:_.lon,clip:_.clip}),u.push(e))},R=function(e,t){var a=p[t],l=Math.floor(t/g),s=t-l*g;l--,s--;var d,f=a[2],c=a[4],v=i+n*s;d=l<0?r:l==h-1?r-o*l:r-(o*l+f*o),e.push({lat:d,lon:v,clip:c}),a[2]=-1;var m;if(1==a[0]){if(p[m=t+g-1][1]>=0)return O(e,m);if(p[m=t-1][2]>=0)return R(e,m);if(p[m=t-1][1]>=0)return O(e,m)}else{if(p[m=t][1]>=0)return O(e,m);if(p[m=t+1][2]>=0)return R(e,m);if(p[m=t+g][1]>=0)return O(e,m)}var _=e[0];_&&(e.push({lat:_.lat,lon:_.lon,clip:_.clip}),u.push(e))},x=0;x<m;){var F=p[x];F[1]>=0&&O([],x),F[2]>=0&&R([],x),x++}for(var L=[],C=0;C<u.length;C++){for(var M=u[C],U=[],N=0;N<M.length;N++){var F=M[N];U.push([F.lon,F.lat])}U.length&&L.push(U)}return L}function n(e,t){var i=a.index[e],r={};if(i)for(var n=0;n<i.length;n++){var o=i[n];o.erupted_date==t&&(r[o.acos_type]=o)}return r.visible||r.puff}function o(e,a,i,r){var o=n(e,a);if(o){var l=o.acos_type,s=t.Attributes.FilePath;if(s=s.replace("%id%",e),s=s.replace("%type%",l),s=s.replace("%basetime%",a),s=s.replace("%validtime%",i),s=s.replace("%level%",r),s=WRAP.DH._getCurrentConfiguration(s),s.indexOf("%")<0)return s}return console.error("ACOS Data handler invalid data path. id="+e+" basetime="+a+" validtime="+i+" level="+r),null}function l(e,a,i,r){var o=n(e,a);if(o){var l=o.acos_type,s=t.Attributes.DataConfig;if(s=s.replace("%id%",e),s=s.replace("%type%",l),s=s.replace("%basetime%",a),s=s.replace("%validtime%",i),s=s.replace("%level%",r),s=WRAP.DH._getCurrentConfiguration(s),s.indexOf("%")<0)return s}return console.error("ACOS Data handler invalid conf path. id="+e+" basetime="+a+" validtime="+i+" level="+r),null}var s=this;s.name=t.Name,s.ref=e,s.data_cache=new WRAP.DH._cache(200),s.contour_cache=new WRAP.DH._cache(200),s.indexfile=t.Attributes.Index,s.timelist=t.Attributes.TimeList,s.dataconf=t.Attributes.DataConfig,s.update_interval=parseFloat(t.Attributes.UpdateInterval),this.autoUpdate=function(){if(this.timer&&(clearTimeout(this.timer),this.timer=null),s.update_interval>0){var e=WRAP.Core.currentTimeScale();if(e>0){var t=1e3*s.update_interval/e;this.timer=setTimeout(function(){s.ref.load()},t)}}},this.loadCompletion=function(e,t){for(var i in a.index)for(var r=a.index[i],n=0;n<r.length;n++)if(!r[n].validtime)return!1;return t("completed",e),!0},this.setTimelist=function(e,t){if(t)for(var a=0;a<t.length;a++)if(t[a].basetime==e.erupted_date)return e.validtime=t[a].validtime,!0;var i="Datahandler Timelist Formart Error";return console.error(i),s._error=i,!1},this.loadTimelist=function(e,t,i,r){var n=t.acos_type,o=a.timelist[e][n];if(o){if("loading"!=o&&!s.setTimelist(data,o))return}else{a.timelist[e][n]="loading";var l=s.timelist.replace("%id%",e);l=l.replace("%type%",n),l=WRAP.DH._getCurrentConfiguration(l),WRAP.DH._getJSON(l,"TimeList",function(t){a.timelist[e][n]=t.timelist;for(var o=0;o<a.index[e].length;o++){var l=a.index[e][o];l.acos_type==n&&(s.setTimelist(l,t.timelist)||(l.validtime=[]))}s.loadCompletion(i,r)},function(t){var o="Datahandler Timelist Load Error("+t+")";console.error(o),s._error=o,a.timelist[e][n]=[];for(var l=0;l<a.index[e].length;l++){var d=a.index[e][l];d.acos_type==n&&(d.validtime=[])}s.loadCompletion(i,r)})}},this.load=function(e,t){var i=WRAP.DH._getCurrentConfiguration(s.indexfile);i&&(s._error=null,a.index={},a.timelist={},WRAP.DH._getJSON(i,"Index",function(i){if(i&&i.index){a.index=i.index;for(var r in a.index){a.timelist[r]={};for(var n=a.index[r],o=0;o<n.length;o++)s.loadTimelist(r,n[o],e,t)}}else WRAP.DH._error(s.name+" Index format."),t("error",e);s.autoUpdate()},function(e){var t="Datahandler Index File Load Error("+e+")";console.error(t),s._error=t}))};var d,u={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams"},f={};for(d in u)f[u[d]]=parseInt(d);var h=[f.BitsPerSample,f.ExtraSamples,f.SampleFormat,f.StripByteCounts,f.StripOffsets,f.StripRowCounts,f.TileByteCounts,f.TileOffsets],c={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",16:"LONG8",17:"SLONG8",18:"IFD8"},g={};for(d in c)g[c[d]]=parseInt(d);var v={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"},m=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),p=function(){function e(e){this._dataView=new DataView(e)}return m(e,[{key:"getUint64",value:function(e,t){var a=this.getUint32(e,t),i=this.getUint32(e+4,t);return t?a<<32|i:i<<32|a}},{key:"getInt64",value:function(e,t){var a,i;return t?(a=this.getInt32(e,t),i=this.getUint32(e+4,t),a<<32|i):(a=this.getUint32(e,t),i=this.getInt32(e+4,t),i<<32|a)}},{key:"getUint8",value:function(e,t){return this._dataView.getUint8(e,t)}},{key:"getInt8",value:function(e,t){return this._dataView.getInt8(e,t)}},{key:"getUint16",value:function(e,t){return this._dataView.getUint16(e,t)}},{key:"getInt16",value:function(e,t){return this._dataView.getInt16(e,t)}},{key:"getUint32",value:function(e,t){return this._dataView.getUint32(e,t)}},{key:"getInt32",value:function(e,t){return this._dataView.getInt32(e,t)}},{key:"getFloat32",value:function(e,t){return this._dataView.getFloat32(e,t)}},{key:"getFloat64",value:function(e,t){return this._dataView.getFloat64(e,t)}},{key:"buffer",get:function(){return this._dataView.buffer}}]),e}();i.prototype={getOffset:function(e){return this.bigTiff?this.dataView.getUint64(e,this.littleEndian):this.dataView.getUint32(e,this.littleEndian)},getFieldTypeLength:function(e){switch(e){case g.BYTE:case g.ASCII:case g.SBYTE:case g.UNDEFINED:return 1;case g.SHORT:case g.SSHORT:return 2;case g.LONG:case g.SLONG:case g.FLOAT:return 4;case g.RATIONAL:case g.SRATIONAL:case g.DOUBLE:case g.LONG8:case g.SLONG8:case g.IFD8:return 8;default:throw new RangeError("Invalid field type: "+e)}},getValues:function(e,t,a){var i,r=null,n=null,o=this.getFieldTypeLength(e);switch(e){case g.BYTE:case g.ASCII:case g.UNDEFINED:r=new Uint8Array(t),n=this.dataView.getUint8;break;case g.SBYTE:r=new Int8Array(t),n=this.dataView.getInt8;break;case g.SHORT:r=new Uint16Array(t),n=this.dataView.getUint16;break;case g.SSHORT:r=new Int16Array(t),n=this.dataView.getInt16;break;case g.LONG:r=new Uint32Array(t),n=this.dataView.getUint32;break;case g.SLONG:r=new Int32Array(t),n=this.dataView.getInt32;break;case g.LONG8:case g.IFD8:r=new Array(t),n=this.dataView.getUint64;break;case g.SLONG8:r=new Array(t),n=this.dataView.getInt64;break;case g.RATIONAL:r=new Uint32Array(2*t),n=this.dataView.getUint32;break;case g.SRATIONAL:r=new Int32Array(2*t),n=this.dataView.getInt32;break;case g.FLOAT:r=new Float32Array(t),n=this.dataView.getFloat32;break;case g.DOUBLE:r=new Float64Array(t),n=this.dataView.getFloat64;break;default:throw new RangeError("Invalid field type: "+e)}if(e!==g.RATIONAL&&e!==g.SRATIONAL)for(i=0;i<t;++i)r[i]=n.call(this.dataView,a+i*o,this.littleEndian);else for(i=0;i<t;i+=2)r[i]=n.call(this.dataView,a+i*o,this.littleEndian),r[i+1]=n.call(this.dataView,a+(i*o+4),this.littleEndian);return e===g.ASCII?String.fromCharCode.apply(null,r):r},getFieldValues:function(e,t,a,i){var r,n=this.getFieldTypeLength(t);if(n*a<=(this.bigTiff?8:4))r=this.getValues(t,a,i);else{var o=this.getOffset(i);r=this.getValues(t,a,o)}return 1===a&&h.indexOf(e)===-1&&t!==g.RATIONAL&&t!==g.SRATIONAL?r[0]:r},parseGeoKeyDirectory:function(e){var t=e.GeoKeyDirectory;if(!t)return null;for(var a={},i=4;i<4*t[3];i+=4){var r=v[t[i]],n=t[i+1]?u[t[i+1]]:null,o=t[i+2],l=t[i+3],s=null;if(n){if(s=e[n],"undefined"==typeof s||null===s)throw new Error("Could not get value of geoKey '"+r+"'.");"string"==typeof s?s=s.substring(l,l+o-1):s.subarray&&(s=s.subarray(l,l+o-1))}else s=l;a[r]=s}return a},parseFileDirectories:function(e){for(var t=e,a=[];0!==t;){for(var i=this.bigTiff?this.dataView.getUint64(t,this.littleEndian):this.dataView.getUint16(t,this.littleEndian),r={},n=e+(this.bigTiff?8:2),o=0;o<i;n+=this.bigTiff?20:12,++o){var l=this.dataView.getUint16(n,this.littleEndian),s=this.dataView.getUint16(n+2,this.littleEndian),d=this.bigTiff?this.dataView.getUint64(n+4,this.littleEndian):this.dataView.getUint32(n+4,this.littleEndian);r[u[l]]=this.getFieldValues(l,s,d,n+(this.bigTiff?12:8))}a.push([r,this.parseGeoKeyDirectory(r)]),t=this.getOffset(n)}return a}};var _=function(e,t,a,r){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="arraybuffer",n.onload=function(){var o=3;if(!Module)return console.error("WRAP.ASM Module not found."),void r(e,[]);Module.printErr=function(e){e=null},Module.tmpFileID?Module.tmpFileID+=1:Module.tmpFileID=1;var l=String(Module.tmpFileID)+".tiff";Module.FS.createDataFile("/",l,new Uint8Array(n.response),!0,!1);var s=Module.ccall("TIFFOpen","number",["string","string"],[l,"r"]);if(!s)return console.error("Tiff load error. "+l),void r(e,[]);var d,u=new i(this.response),f=u.fileDirectories&&u.fileDirectories[0]&&u.fileDirectories[0][0],h=f.ImageWidth,c=f.ImageLength,g=f.SampleFormat&&f.SampleFormat[0],v=Module.ccall("_TIFFmalloc","number",["number"],[h*c*4]);if(d=g==o?Module.ccall("TIFFReadEncodedStrip","number",["number","number","number","number"],[s,0,v,h*c*4]):Module.ccall("TIFFReadRGBAImageOriented","number",["number","number","number","number","number","number"],[s,h,c,v,1,0]),0===d)return console.error("GeoTiff Data Parse Error"),void r([]);var f;f=g==o?Module.HEAPF32.subarray(v/4,v+h*c):Module.HEAPU8.subarray(v,v+h*c*4);var m=[],p=h*c;if(g==o)if(isNaN(t)||isNaN(a))if(isNaN(t))if(isNaN(a))for(var _=0;_<p;_++)m[_]=f[_];else for(var _=0;_<p;_++){var y=f[_];y<=a&&(m[_]=y)}else for(var _=0;_<p;_++){var y=f[_];t<=y&&(m[_]=y)}else for(var _=0;_<p;_++){var y=f[_];t<=y&&y<=a&&(m[_]=y)}Module.ccall("_TIFFfree","number",["number"],[v]),Module.ccall("TIFFClose","number",["number"],[s]),r(e,m)},n.onerror=function(){var t=[];r(e,t)},n.send()};this.getContour=function(e,t,a,i){var n=o(e,t,a,i);if(!n)return[];var l=this.contour_cache.get(n);if(l&&l.data)return l.data;var l=this.data_cache.get(n);return l&&l.data&&l.data.data?r(l.data.conf,l.data.data):null},this.getGPV=function(e,t,a,i){var r=o(e,t,a,i);if(!r)return console.error("ACOS Data not found id="+e+" base="+t+" valid="+a+" level="+i),{data:null,conf:null};var n=this.data_cache.get(r);return n&&n.data?n:null},this.loadData=function(e,t,a,i,r){var n=o(e,t,a,i);if(n&&!s.data_cache.get(n)){s.data_cache.set(n,{});var d=l(e,t,a,i);d&&WRAP.DH._getJSON(d,"DataConf",function(e){var t=e.Attributes;t?_(n,t.DataGrid.MinValue,t.DataGrid.MaxValue,function(e,a){s.data_cache.set(e,{data:a,conf:t}),r()}):s._error="Datahandler Invalid Data Conf Format("+d+")"},function(e){s._error="Datahandler Data Conf File Load Error("+e+")",s.data_cache.set(n,{data:[],conf:null}),r()})}},s.update_interval>0&&s.ref.load()},WRAP.DH.DataHandler.LiveCamera=function(e,t,a){var i=36e3,r=10,n=this;n.initial=!0,n.ref=e,n.name=t.Name,n.camera_master=t.Attributes.CameraMaster,n.camera_info=t.Attributes.CameraInfo,n.image_file_list=t.Attributes.ImageFileList,n.image_file=t.Attributes.ImageFile,n.update_interval=parseFloat(t.Attributes.UpdateInterval),n.auto_update=!1,this.autoUpdate=function(){if(this.timer&&(clearTimeout(this.timer),this.timer=null),n.update_interval>0){var e=WRAP.Core.currentTimeScale();if(e>0){var t=1e3*n.update_interval/e;this.timer=setTimeout(function(){n.ref.load()},t)}}},this.load=function(e,o){var l=e._path.length;if(l<3){if(!a.data||n.auto_update){var s=WRAP.DH._getCurrentConfiguration(n.camera_master);WRAP.DH._get(s,"LiveCamera Master",function(i){if(i){a.data||(a.data={});for(var r=i.split("\n"),l=0,s=0;s<r.length;s++){var d=r[s];d.length&&(l++,a.data[d]||(a.data[d]={}),a.data[d].active=!0)}var u=0;for(var f in a.data)if(a.data[f].active){delete a.data[f].active;var h=WRAP.DH._getCurrentConfiguration(n.camera_info);h=WRAP.DH._customizeConfiguration(h,"id",f),WRAP.DH._getJSON(h,"LiveCamera Info",function(i){if(i){if(a.data[i.AREA]){var r=a.data[i.AREA];r.area_name=i.AREA,r.e_name=i.Shibakoen,r.l_name=i.LNAME,r.company=i.COMPNY,r.jpscsn=i.JPSCSN,r.lat=60*parseFloat(i.LATD),r.lon=60*parseFloat(i.LOND),r.dir=i.DIR!=-1?22.5*i.DIR:void 0,r.gid=i.GID,!n.initial||t.Attributes.InitialLoad?e.query("data").query(i.AREA).load(function(){++u>=l&&(n.initial=!1,o("completed",e))}):++u>=l&&(n.initial=!1,o("completed",e))}}else++u>=l&&(n.initial=!1,o("completed",e))})}else delete a.data[f]}else WRAP.DH._error("LiveCamera Master not found."),o("error",e);n.auto_update&&n.autoUpdate()})}}else if(l>=3){var d=e._path[2],u=WRAP.DH._currentTime(),f=WRAP.DH._setTime(u,-i),h=WRAP.DH._timeString(f,"","",""),c=WRAP.DH._timeString(u,"","",""),g=WRAP.DH._getCurrentConfiguration(n.image_file_list);g=WRAP.DH._customizeConfiguration(g,"id",d),g=WRAP.DH._customizeConfiguration(g,"time_start",h),g=WRAP.DH._customizeConfiguration(g,"time_end",c),WRAP.DH._getJSON(g,"LiveCamera File List",function(t){if(t&&t.keys&&a.data[d]){t.keys.sort(function(e,t){return e>t?-1:e<t?1:0});for(var i=a.data[d].image,s=a.data[d].image=[],u=0,f=0;f<t.keys.length;f++){var h=t.keys[f].split("."),c=WRAP.DH._time(h[0]),g=WRAP.DH._timeString(c),v=null,m=!1;if(i)for(var p=0;p<i.length;p++)if(i[p].time==g){m=!0,v=i[p].image;break}if(l>3||0==f||m){var _;if(s.push(_={time:g,image:v}),!m){var y=new Image;_.image=y,y.target=_,y.onload=function(){},y.onerror=function(){y.onerror=null,y.src="img/broken_img.png"};var c=WRAP.DH._time(g),A=WRAP.DH._timeString(c,"","",""),T=WRAP.DH._getCurrentConfiguration(n.image_file);T=WRAP.DH._customizeConfiguration(T,"id",d),T=WRAP.DH._customizeConfiguration(T,"time",A),y.src=T}}if(++u>=r)break}}o("completed",e)})}},n.update_interval>0&&n.ref.load()};
//# sourceMappingURL=../build/js/WRAP.DH-1.3.1.5-min.js.map